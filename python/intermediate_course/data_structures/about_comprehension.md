---
tags: Python 中級
lang: ja-jp
robots: noindex, nofollow
breaks: false
---

<style>
.code {
user-select: none;
-ms-user-select: none;
-webkit-user-select: none;
cursor: not-allowed
}
</style>

# 7. 内包表記

## 導入
内包表記とは、リストやタプル、辞書型、集合型を手軽に生成するための表記方法です。これは、`Python`における強力な記述方法です。

## 解説
### リテラブルについて
リテラブルとは、繰り返し可能のデータ構造のことです。もう少し簡単に言うと、`for`文が使えるデータ構造です。つまり、リテラブルであれば、`for`文で要素を順番に取り出して処理する事が可能です。

pythonに置いて、リスト、タプル、辞書、集合が基本のリテラブル型になります。これ以外、`range()`関数の返り値もリテラブルになっています。


### リストの内包表記
1以上10以下の整数のリストの各要素を二倍にしたリストを作りたい場合、以下のコードで作れます。
```python=1
# 1以上10以下の整数のリストの各要素を二倍にする
num = []
for i in range(1, 11):
    num.append(i * 2)
print(num)
```
|行番号|解説|
|---|---|
|2|空のリストを作ります。|
|3, 4|1から10までの整数をiに格納し、iを２倍してリスト変数`num`に追加します。|
|5|出力結果は1から10までの整数を2倍にした整数のリストでです。|
これを内包表記で記述すると、以下のようになります。4行で書いたコードはたった2行で記述することができました。

```python=1
# 内包表記での記述 
num = [i * 2 for i in range(1, 11)]
print(num)
```
|行番号|解説|
|---|---|
|2|`式 for 変数　in イテラブルオブジェクト`　これはリストの内包表記の基本的な記述方法は次の通りです。上記のコードを見ると、式に当たる部分は`i * 2`、変数は`i`、イテラブルオブジェクトは`range(1, 11)`から順番に取り出した変数になります。|

### 条件判断付きの内包表記
#### その① ifだけが存在する時
```python=1
# 20以下の3の倍数のリスト
num = []
for i in range(1, 21):
    if i % 3 == 0:
        num.append(i)
print(num)
```
|行番号|解説|
|---|---|
|2|空のリスト`num`を作ります。|
|3~5|1から20まで、3で割り切れた整数をリスト`num`に追加します|
|6|1から20まで、3の倍数が入ってるリストが出力されます。|

これは内包表記で記述すると以下のようになります。`for`の後に`if`を記述して、内容をフィルタリングできるようになっています。

```python=1
# 内包表記で記述 
num1 = [i for i in range(1, 21) if i % 3 ==0]
print(num1)
```
|行番号|解説|
|---|---|
|1|`式 for 変数　in イテラブルオブジェクト if 条件`|
|2|`if i % 3 ==0`という条件を最後につけると、3の倍数のみ`num1`というリストに追加されます。|

#### その② if-elseを使う時
```python=1
# 20以下の3の倍数であれば、その数字を文字列にして追加し、それ以外の場合は文字列'a'で置き換える
num = []
for i in range(1, 21):
    if i % 3 == 0:
        num.append(str(i))
    else:
        num.append('a')
print(num)
```
|行番号|解説|
|---|---|
|2|空のリスト`num`を作ります。|
|3|1から20までの数字を含むイテラブルオブジェクトを生成し、<br>その中の要素を順番に取り出し、変数`i`に入れる。<br>そして変数`i`に対し、以下の処理をする|
|4,5|変数`i`の中に格納されているデータが3の倍数であれば、<br>`i`のデータをそのまま文字列にして`str(i)`、`num`に追加する|
|6,7|それ以外の場合は`i`の中の数字の代わりに、<br>文字列`'a'`を`num`の中に入れる|
|8|先程作ったリストが出力されます。|

これは内包表記で記述すると以下のようになります。<br>`for`の前に`「条件式が真のときのデータ処理」 if 「条件式」 else 「条件式が偽のときのデータ処理」`を記述して、内容を違う条件で処理できるようになっています。

```python=1
# 内包表記で記述 
num1 = [str(i) if i % 3 ==0 else 'a' for i in range(1, 21)]
print(num1)
```
|行番号|解説|
|---|---|
|1|`[3項演算子 for 変数　in イテラブルオブジェクト]`<br>三項演算子とは、`「条件式が真のときのデータ処理」 if 「条件式」 else 「条件式が偽のときのデータ処理」`のこと。<br>この例では、三項演算子の意味は`「iを文字列にして追加」 if 「iが3の倍数である」 else 「文字列'a'を追加」`となっています。|
|2|以上で作成したリストが出力されます。|


### 辞書の内包表記
```python=1
# 二十歳以上の生徒名と年齢を辞書型で出力
student_age = {'yuki': 21, 'naoko': 24, 'haruto': 18, 'makoto': 25}
over_twenty = {}
for k,v in student_age.items():
    if v >= 20:
        over_twenty[k] = v
print(over_twenty)
```
|行番号|解説|
|---|---|
|2|生徒の名前と年齢を格納する辞書変数`student_age`を作ります。|
|3|二十歳以上の生徒の情報を格納する空の辞書を先に作成します。|
|4|ループ変数`k,v`はそれぞれ辞書の`key`と`value`に対応し、ここではそれぞれ生徒の名前と年齢を表します。|
|5,6|年齢が二十歳以上の生徒を`over_twenty`に情報を追加します。|

```python=1
# # 内包表記で記述
student_age = {'yuki': 21, 'naoko': 24, 'haruto': 18, 'makoto': 25}
print({k:v for k,v in student_age.items() if v >= 20})
```
|行番号|解説|
|---|---|
|3|リストの内包表記と同じように、基本的な記述方法は以下のようになっています。　`式 for 変数　in イテラブルオブジェクト if 条件`|
|3|ここのイテラブルオブジェクトは辞書のキーと値を同時に取り出すのに使う`items()`です。|

注意:
python3.6以降、辞書型に対する`for`文の処理はキー値が追加された順番で取り出すようになりました。python3.6以前では、キー値が順番通りに取り出されるとは限りません。キー値の追加が意味ある時(例えば、時間情報)、`for`文を回すときに取り出される順番は注意しましょう。

### タプルと集合型の内包表記
タプルは`tuple()`関数、集合型は`set()`関数によって、リストから変換することが可能なので、基本は`関数(リスト内包表記)`で作成することができます。それ以外、以下の書き方も可能です。
```python=1
# リストから重複を取り除き、setにする
no_dup = {i for i in [1,2,3,2,1]}
print('no_dup:', no_dup)
# 辞書のkey値をタプルにする
key_tuple = tuple(k for k in {'a':1, 'b':2})
print('key_tuple:', key_tuple)
```

## クイズ
